var CKAN=CKAN||{};CKAN.DguDatasetMap=function(a){var b=function(a){return a.geometry.CLASS_NAME.split(".").pop().toLowerCase()},c=function(a){var b=CKAN.DguDatasetMap.styles,c=b[a]?b[a]:b["default"];return new OpenLayers.StyleMap(OpenLayers.Util.applyDefaults(c,OpenLayers.Feature.Vector.style["default"]))};return{map:null,extent:null,styles:{"default":{fillColor:"#FCF6CF",strokeColor:"#B52",strokeWidth:2,fillOpacity:.4}},setup:function(){if(!this.extent)return!1;var d=a("#dataset-map-container").width(),e=a("#dataset-map-container").height();a("#dataset-map-container").height(e);var f=new OpenLayers.Bounds(-30,48,3.5,64),g=new OpenLayers.Format.GeoJSON,h=g.read(this.extent);if(!h)return!1;var i=h[0].geometry.getBounds();this.map_type=f.containsBounds(i)?"os":"osm";var j=a("#dataset-map-attribution");assert(j.length>0);var k=[new OpenLayers.Control.Attribution({div:j[0]})];if("osm"==this.map_type){var l=["http://otile1.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile3.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile4.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg"],m=[new OpenLayers.Layer.OSM("MapQuest-OSM Tiles",l,{attribution:'Map data CC-BY-SA by <a href="http://openstreetmap.org">OpenStreetMap</a> | Tiles by <a href="http://www.mapquest.com">MapQuest</a>'})];this.map=new OpenLayers.Map("dataset-map-container",{projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"m",numZoomLevels:18,maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),controls:k});var n=new OpenLayers.Projection("EPSG:900913")}else if("os"==this.map_type){var o="Contains Ordnance Survey data (c) Crown copyright and database right  [2012].Contains Royal Mail data (c) Royal Mail copyright and database right [2012].Contains bathymetry data by GEBCO (c) Copyright [2012].Contains data by Land & Property Services (Northern Ireland) (c) Crown copyright [2012].",m=[new OpenLayers.Layer.WMS("Geoserver layers - Tiled",this.tiles_url,{LAYERS:"InspireETRS89",STYLES:"",format:"image/png",tiled:!0},{buffer:0,displayOutsideMaxExtent:!0,isBaseLayer:!0,attribution:o,transitionEffect:"resize"})];OpenLayers.DOTS_PER_INCH=90.71428571428572;var p={size:new OpenLayers.Size(d,e),scales:[15e6,1e7,5e6,1e6,25e4,75e3],maxExtent:f,restrictedExtent:f,tileSize:new OpenLayers.Size(250,250),units:"degrees",projection:"EPSG:4258",controls:k};this.map=new OpenLayers.Map("dataset-map-container",p);var n=new OpenLayers.Projection("EPSG:4258")}this.map.addLayers(m);var g=new OpenLayers.Format.GeoJSON({internalProjection:n,externalProjection:new OpenLayers.Projection("EPSG:4326")}),h=g.read(this.extent),q=b(h[0]),r=new OpenLayers.Layer.Vector("Dataset Extent",{projection:new OpenLayers.Projection("EPSG:4326"),styleMap:c(q)});this.map.addLayer(r),r.addFeatures(h),"point"==q?this.map.setCenter(new OpenLayers.LonLat(h[0].geometry.x,h[0].geometry.y),this.map.numZoomLevels/2):this.map.zoomToExtent(r.getDataExtent())}}}(jQuery);